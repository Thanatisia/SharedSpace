# Grub - Configurations and Customization

## Information
### Folders
+ /etc/default : Contains System defaults
	- the /etc/default handles default configurations including the tty
		- Your bootloader handles the initial boot-up launch/setup process such as (and including)
			+ TTY Resolution
			+ Starting up operating systems registered by the Boot manager
+ /boot/grub : Grub boot configurations and resources such as fonts, themes, aritecture and config file

### Files
+ System Default Grub Configuration File (Manual Editable) : /etc/default/grub
+ Grub system-generated configuration file (Autogenerated) : /boot/grub/grub.cfg

### General Steps
- Make Modifications to '/etc/default/grub'
    ```console
    sudo $EDITOR /etc/default/grub
    ```
    
- Re-generate your Grub configurations
    ```console
	sudo grub-mkconfig -o /boot/grub/grub.cfg
    ```

## Visual Configuration

### Change the look of the menu
```
You can edit the TTY resolution and other variables by
editing the '/etc/defult/grub' file

- the '/etc/default/grub' handles the GRUB Bootloading functionality during the system bootup/startup process
```
- Set the framebuffer (tty) resolution
	+ GRUB can set the framebuffer for both GRUB itself (GFXMODE) and the Kernel (GFXPAYLOAD)
	- Methods
		- Setting GRUB_GFXMODE and GRUB_GFXPAYLOAD_LINUX
			+ The preferred method is by editing '/etc/default/grub'
			- set GRUB_GFXMODE with the 'width (pixels) x height (pixels) x color depth (bits {8|16|24|32})
				+ as well as a fallback resolution with other options
				```console
				# sudo $EDITOR /etc/default/grub
				GRUB_GFXMODE=widthxheightxcolor_bits,1024x768,auto
				```
			+ (OPTIONAL) set GRUB_GFXPAYLOAD_LINUX with the option of what the kernel should do
				```console
				# sudo $EDITOR /etc/default/grub
				GRUB_GFXPAYLOAD_LINUX=keep
				```
			+ Regenerate grub.cfg after making changes
				```console
				sudo grub-mkconfig -o /boot/grub/grub.cfg
				```
			+ Reboot system
				```console
				sudo reboot now
				```

- Changing Background image and bitmap fonts
	```
	GRUB comes with support for background images and bitmap fonts in .pf2 format
	- The unicode font is included in the 'grub' package
		+ Under the filename 'unicode.pf2'
		- or only ASCII characters
			+ Under the filename 'ascii.pf2'
 		+ Get the filepaths
			pacman -Ql grub | grep pf2
	```
    - Changing Background Image
        - Image format supports
            + tga
            + png
            + jpeg
        - Maximum supported resolution : Depends on Hardware
        - Pre-Requisites
            + Set up proper framebuffer resolution
        - Setup
            - Edit '/etc/default/grub'
                ```console
                # sudo $EDITOR /etc/default/grub
                GRUB_BACKGROUND="/path/to/grub/image"
                ```
            - Regenerate grub.cfg after making changes
                ```console
                sudo grub-mkconfig -o /boot/grub/grub.cfg
                ```
                - If is successful
                    + User will see "Found background image..." in the terminal after the command is executed
                - If the image is not displayed
                    - Check
                        + The path and the filename in /etc/default/grub are correct
                        + The image is of the proper size and format (tga, png, 8-bit jpg)
                        + The image was saved in the RGB mode, and is not indexed
                        + The console mode is not enabled in /etc/default/grub
                        + The command grub-mkconfig must be executed to place the background image information into the /boot/grub/grub.cfg file
                        + The grub-mkconfig scripts will not quote the file name in grub.cfg so make sure it does not contain spaces
                       
        - Reboot system
            ```console
            sudo reboot now
            ```
                       
    - Changing Fonts
        - Pre-Requisites
            - Need to convert your normal font files (.ttf|.otf) to a GRUB-recognizable format (.pf2)
                - Look for a font
                    ```console
                    fc-list | grep "your-font"
                    ```
                - Convert the font into a format that GRUB can actually read
                    - Using 'grub-mkfont'
                        + The converted font will be outputted to the specified output location and font filename
                    ```console
                    sudo grub-mkfont -s [size] -o [output-location-filename] [target-font-location]
                    ```
        - Setup
            - Edit '/etc/default/grub'
                ```console
                # sudo $EDITOR /etc/default/grub
                GRUB_FONT="/path/to/font.pf2"
                ```
                
            - Regenerate grub.cfg after making changes
                ```console
                sudo grub-mkconfig -o /boot/grub/grub.cfg
                ```

		- Reboot system
			```console
			sudo reboot now
			```

- Changing Theme
	- Information
		+ When using a theme: Your splash image will usually not be displayed
	- Setup
		- Edit '/etc/default/grub'
			+ grub user share themes folder : "/usr/share/grub/themes/[theme-name]/theme.txt"
			```console
			# sudo $EDITOR /etc/default/grub
			GRUB_THEME="/path/to/gfxtheme"
			```
		- Regenerate grub.cfg after making changes
			```console
			sudo grub-mkconfig -o /boot/grub/grub.cfg
			```
			- If is successful
				+ User will see "Found theme: [path/to/theme/theme.txt]" in the terminal after the command is executed
		- Reboot system
			```console
			sudo reboot now
			```

- Changing Menu Colors
	- Information
		+ You can set the menu colors in GRUB
		+ The available colors for GRUB can be found in the [GRUB manual](https://www.gnu.org/software/grub/manual/html_node/Theme-file-format.html)
	- Setup
		- Edit '/etc/default/grub'
			```console
			# sudo $EDITOR /etc/default/grub
			GRUB_COLOR_NORMAL="foreground-color/background-color"
			GRUB_COLOR_HIGHLIGHT="foreground-color/background-color"
			```

		- Regenerate grub.cfg after making changes
			```console
			sudo grub-mkconfig -o /boot/grub/grub.cfg
			```

		- Reboot system
			```console
			sudo reboot now
			```

- Hiding/Showing Menu (Timeout)
	- Information
		- GRUB is able to hide/skip the menu by holding 'ESC' and 
			+ Show the menu by letting go of the 'ESC' button
		- You can also adjust whether you want to see the timeout counter
	- Setup
		- Edit '/etc/default/grub'
			```console
			# sudo $EDITOR /etc/default/grub
			GRUB_TIMEOUT=5
			GRUB_TIMEOUT_STYLE='{menu|countdown|hidden}'
			```
		- Regenerate grub.cfg after making changes
			```console
			sudo grub-mkconfig -o /boot/grub/grub.cfg
			```
		- Reboot system
			```console
			sudo reboot now
			```

- Changing GRUB Boot Menu Order and Default Option
    ```
    Lets say that If for some reason, whatever that shows up on top of your GRUB menu isnt actually what you want to be a default
    and that it is not in the right order
    
    GRUB allows you to 
        - change the drive boot order listed in the menu and
        - Default options
    ```
    - Change GRUB Boot Menu Order
        - Information
            + The drive boot order starts from 0 in the list (Because it is a list indexed from 0)
        - Setup
            - Edit '/etc/default/grub'
                - Option
                    + n = Drive order number (starting from 0 = 1st Item in the List, 1 = 2nd Item in the List) of the drive you want to set as default
                ```console
                # sudo $EDITOR /etc/default/grub
                GRUB_DEFAULT=n
                ```
            - Regenerate grub.cfg after making changes
                ```console
                sudo grub-mkconfig -o /boot/grub/grub.cfg
                ```
            - Reboot system
                ```console
                sudo reboot now
                ```
            
    - Remember the last thing you selected in the menu
        - Information
            - saved : To save the drive order number as the default and remember the order number
                + This is Required for GRUB to remember the last thing you selected in the menu)
        - Setup
             - Edit '/etc/default/grub'
                - Option
                ```console
                # sudo $EDITOR /etc/default/grub
                GRUB_DEFAULT=saved
                GRUB_SAVEDEFAULT=true
                ```
            - Regenerate grub.cfg after making changes
                ```console
                sudo grub-mkconfig -o /boot/grub/grub.cfg
                ```
            - Reboot system
                ```console
                sudo reboot now
                ```
            
## Wiki

### Visual Configurations

#### TTY Resolution
+ GRUB_GFXMODE : Handles the framebuffer for GRUB; Set a resolution for GRUB to display at
	- Syntax
		```
		GRUB_GFXMODE=[desired-resolution],[fallback-resolution (such as 1024x768-32)],[options,...]
		```
        - desired-resolution
            + Structure : width-pixels(x)height-pixels(x)color-depths-bits
        - fallback-resolution
            + Structure : width-pixels(x)height-pixels(x)color-depths-bits
	- Options
		+ auto : Let the system Automatically handle and choose the best resolution (DEFAULT)
    - Recommended
        + Always add an 'auto' right at the end so the system is able to have a default fallback assuming both the desired and fallback fails
            ```
            GRUB_GFXMODE=[desired-resolution],[fallback-resolution],auto
            ```
+ GRUB_GFXPAYLOAD_LINUX : Handles the framebuffer options for the Kernel
	- Syntax
		```
		GRUB_GFXPAYLOAD_LINUX={options}
		```
	- Options
		+ keep : Makes sure that the kernel acknowledges the changes made to 'GRUB_GFXMODE' and keeps the resolution (Default)
        + text : To tell the kernel to use the text terminal instead of GRUB_GFXMODE TTY; NOTE: To disable framebuffer - you need to set 'GRUB_TERMINAL_OUTPUT' to 'console'

#### Background
+ GRUB_BACKGROUND : Set the background image of the GRUB Bootloader
	- Syntax
		```
		GRUB_BACKGROUND="/path/to/grub/image"
		```
	- Location: Generally the path is located/placed in '/boot/grub' so that it is all in 1 location, but the location doesnt matter
+ GRUB_THEME : Set the general theme of the GRUB Bootloader
	- Information
		+ Will override GRUB_BACKGROUND and GRUB_FONT
	- Components
		+ Background Image
		+ Color scheme
		+ Fonts
	- Syntax
		```
		GRUB_THEME="/path/to/gfxtheme"
		```
	- Location: Generally the path is located/placed in '/usr/share/grub/themes/[theme-name]/theme.txt'
+ GRUB_FONT : Set the font of the GRUB Bootloader menu
	- Syntax
		```
		GRUB_FONT="/path/to/font.pf2"
		```
	- Location: Generally the path is located/placed in '/boot/grub/fonts'
    - GRUB Recognizable Formats
        + .pf2
    - Pre-Requisites
        - Need to convert your normal font files (.ttf|.otf) to a GRUB-recognizable format (i.e : .pf2) so that GRUB can read
            - Look for a font
                ```console
                fc-list | grep "your-font"
                ```
            - Convert the font into a format that GRUB can actually read
                ```console
                sudo grub-mkfont -s [size] -o [output-location-filename] [target-font-location]
                ```

#### Menu Colors
+ GRUB_COLOR_NORMAL : The GRUB Menu colors normally when unselected/unhighlighted
	- Syntax
		```
		GRUB_COLOR_NORMAL="foreground-color/background-color"
		```
    - Information
        - color names
            + Any SVG names
            + You can use hex values for your colors

+ GRUB_COLOR_HIGHLIGHT : The GRUB Menu colors when selected/highlighted
	- Syntax
		```
		GRUB_COLOR_HIGHLIGHT="foreground-color/background-color"
		```
    - Information
        - color names
            + Any SVG names
            + You can use hex values for your colors
        
#### Hidden Menu
+ GRUB_TIMEOUT : Specify how many seconds to countdown (inactivity) before automatically booting into an option that is highlighted
	- Syntax
		```
		GRUB_TIMEOUT=n
		```
		- n = Number of seconds before automatically booting into a selected option
            + Type : Integer
            - Special Values
                + -1 : Disable timeout and wait for user input without automatic boot
                + 0 : Automatically select whatever is highlighted and boot immediately

+ GRUB_TIMEOUT_STYLE : What to do during the timeout countdown
	- Syntax
		```
		GRUB_TIMEOUT_STYLE="options"
		```
	- Options
        + 'menu' : Displays the GRUB menu with the countdown set (DEFAULT)
		+ 'countdown' : Display the timeout/countdown timer on the screen
        + 'hidden' : Hides the GRUB menu during the countdown until the user presses a key; If you want to have a countdown but see a blank screen

#### Disabling Framebuffer
- GRUB_TERMINAL_OUTPUT : Specifies and selects the terminal output device; seperate each devices by space-delimiter (' ')
    - Information
        - To disable framebuffer
            + you will need to set this value to "console" and
            + you will need to set 'GRUB_GFXPAYLOAD_LINUX' to "text"
    - Syntax
        ```
        GRUB_TERMINAL_OUTPUT="console"
        ```
    - Devices
        + console : The TTY/Terminal

#### Changing GRUB Menu Order
+ GRUB_DEFAULT : Set the drive order number in the list that you want to use as the default
    - Information
        + The drive order list starts from 0 because it is in index form
    - Syntax
        ```
        GRUB_DEFAULT=<option>
        ```
    - Options
        - <n> : The drive order number to set as default (Integer)
        - Special Keywords
            - saved : To save the drive order number as the default and remember the order number
+ GRUB_SAVEDEFAULT : Save the selected option for reuse
    - Information
        + Whenever you select an option in your GRUB menu, it is going to save that option and the next time you boot into your system, it is going to try and read out that option and reselect it again
    - Pre-Requisites
        + Requires 'GRUB_DEFAULT' to be set as 'saved'
    - Syntax
        ```
        GRUB_SAVEDEFAULT={true|false}
        ```
       
## Resources
+ [ArchWiki - GRUB - Setting the framebuffer resolution](https://wiki.archlinux.org/title/GRUB/Tips_and_tricks#Setting_the_framebuffer_resolution)
+ [GNU Documentations - GRUB - GFXMODE](https://www.gnu.org/software/grub/manual/grub/html_node/gfxmode.html)
+ [GNU Documentations - GRUB - Theme File Format](https://www.gnu.org/software/grub/manual/html_node/Theme-file-format.html)
+ [YouTube | Brodie Robertson | Try A Grub Theme If You're Bored Just Seeing A Black Screen](https://www.youtube.com/watch?v=smkzKmrtza4)

